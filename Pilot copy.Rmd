---
title: "Pilot"
author: "Isabel"
date: "11/25/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}

library(readxl)
library(tidyr)
library(tidyverse)
library(dplyr)
library(openxlsx)
library(ggplot2)
library(naniar)
library(data.table)
library(labelled)
library(gridExtra)

load(file="pilot.rda")

```

# Representativeness of sample 

## Number of respondents (total + completed only):
```{r, echo=FALSE}
table(pilot$country)
pilot%>%filter(Finished==TRUE)%>%group_by(country)%>%count()
```

## Consent and Age

I think the reason why the rate of incomplete for Myanmar is so much higher could be because of Zawgyi (7.1% saw the consent form and did not proceed) - nothing to be done, unless I duplicate the survey in Zawgyi.

We also see that nearly 20% of respondents in Vietnam who click on the survey were <18. 

```{r, echo=FALSE, message=FALSE}
pilot%>%group_by(country, Q13)%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, Q13, percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(Q13),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+ggtitle("Do you consent?")+theme(legend.title = element_blank())

```

## Gender, Age and Education 

Thai sample seems to be disproportionately more educated. Vietnam and Myanmar's education breakdown seems to be an outcome of the extremely youthful sample. 

```{r, echo=FALSE, message=FALSE}

for (i in c(26, 252:253)) {
  
  x<-paste(colnames(pilot[,i]))
  yy<-filter(pilot, pilot[[i]]!=-99)
  
  print(yy%>%group_by(country, yy[[i]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[i]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[i]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}
```

## Average household income

- Income options need to be tweaked because I am not seeing variation (esp for Indonesia, Malaysia and Philippines) except for Singapore. 
- Possible that people are interpreting the question as individual income? 

```{r, echo=FALSE, fig.height = 15, fig.width=15, message=FALSE}
pilot%>%filter(!is.na(Q6))%>%filter(Q6!=-99)%>%group_by(country, Q6)%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, Q6, percentage)%>%summarize()%>%ggplot(aes(Q6, percentage,label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+ggtitle("Household income")+theme(legend.title = element_blank(), axis.text.x = element_text(angle=45, hjust=1))+facet_wrap(~country, scales='free')

# lapply(dfList, function(x) { 
#   x%>%filter(!is.na(Q6))%>%filter(Q6!=-99)%>%group_by(Q6)%>%summarize(count=n())%>%mutate(pct=count/sum(count))%>%ggplot(aes(Q6, pct))+geom_bar(stat='identity')
#   })
  
```

## Location

```{r, echo=FALSE, message=FALSE, fig.width=15, fig.height=15}

pilot<-pilot%>%mutate(Q8=case_when(Q8=="Greater Bangkok (including Nonthaburi, Pathum Thani & Samut Prakan)" ~ "Greater Bangkok",
                                      TRUE ~ as.character(Q8)))

pilot%>%filter(!country%in%c("Singapore"))%>%filter(!is.na(Q8))%>%filter(Q8!=-99)%>%group_by(country,Q8)%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, Q8, percentage)%>%summarize()%>%ggplot(aes(Q8, percentage,label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+ggtitle("Region")+theme(legend.title = element_blank(), axis.text.x = element_text(angle=45, hjust=1))+facet_wrap(~country, scales='free')

```

## Occupation and sector

- The number of homemakers from Malaysia and Indonesia taking my survey = nearly 40% of my sample! 
- Issue about age for Myanmar and Vietnam in terms of current students. 
- One thing to note is the high no. of unemployed in the Philippines (throughout the sample)

```{r, echo=FALSE, message=FALSE, fig.width=12}
for (i in c(1:2)) {
  cn<-c("Occupation", "Sector")
  v<-c(254:255)
  x<-cn[i]
  yy<-filter(pilot, pilot[[v[i]]]!=-99)
  
  print(yy%>%group_by(country, yy[[v[i]]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[v[i]]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[v[i]]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}

```

```{r, eval=FALSE}
for (i in c(254:255)) {
  
  x<-paste(colnames(pilot[,i]))
  yy<-filter(pilot, pilot[[i]]!=-99)

    
  print(yy%>%group_by(country, yy[[i]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[i]]`,percentage)%>%summarize()%>%ggplot(aes(`yy[[i]]`, percentage, label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(axis.text.x = element_text(angle=45, hjust=1))+facet_wrap(~country, scales='free'))

}

```

## Have you lived overseas before?


```{r, echo=FALSE}
for (i in c(33)) {
  
  x<-paste(colnames(pilot[,i]))
  yy<-filter(pilot, pilot[[i]]!=-99)
  
  print(yy%>%group_by(country, yy[[i]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[i]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[i]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}
```



```{r, eval=FALSE}
for (i in c(45:46)) {
  
  x<-paste(colnames(pilot[,i]))
  yy<-filter(pilot, pilot[[i]]!=-99)
  
  print(yy%>%group_by(country, yy[[i]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[i]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[i]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}
```

```{r, echo=FALSE}
load(file="ABS_v4.rda")
abs<-ABS_v4%>%filter(country %in% c("Philippines", "Thailand", "Indonesia", "Singapore", "Vietnam", "Malaysia", "Myanmar"))
abs<-abs%>%mutate(democracy=case_when(q125==1 ~ "Democracy is always preferable to any other kind of government",
                                      q125==2 ~ "Under some circumstances, an authoritarian government can be preferable to a democratic one", 
                                      q125==3 ~ "For people like me, it does not matter whether we have a democratic or nondemocratic regime", 
                                      TRUE ~ as.character(q125)))
abs$democracy<-factor(abs$democracy, c("Democracy is always preferable to any other kind of government", 
                               "For people like me, it does not matter whether we have a democratic or nondemocratic regime",
                               "Under some circumstances, an authoritarian government can be preferable to a democratic one"))
abs<-abs%>%mutate(democracy1=case_when(q127==1 ~ "Economic development is definitely more important",
                                      q127==2 ~ "Economic development is somewhat more important", 
                                      q127==3 ~ "Democracy is somewhat more important", 
                                      q127==4 ~ "Democracy is definitely more important",
                                      TRUE ~ as.character(q127)))
abs$democracy1<-factor(abs$democracy1, c("Economic development is definitely more important", "Economic development is somewhat more important", "Democracy is somewhat more important", "Democracy is definitely more important"))

abs$country<-factor(abs$country, c("Indonesia", "Malaysia", "Myanmar", "Philippines","Singapore", "Thailand","Vietnam"))

```

## Comparison of 2014 ABS' results and my 2021 pilot results

```{r, echo=FALSE, message=FALSE, fig.width=15}
pilot_econ_demo<-pilot%>%select(country, Q16)%>%filter(!is.na(Q16))%>%mutate(source="pilot (2021)")

abs_econ_demo<-abs%>%select(country, q127)%>%filter(!is.na(q127))%>%filter(q127>0 & q127<5)%>%mutate(source="abs (2014)")

abs_econ_demo<-abs_econ_demo%>%mutate(Q16=(case_when(q127==1 ~ "Economic development is definitely more important",
                                           q127==2 ~"Economic development is somewhat more important", 
                                           q127==3 ~"Democracy is somewhat more important", 
                                           q127==4 ~"Democracy is definitely more important",)))%>%select(-q127)

compare_econ_demo<-rbind(pilot_econ_demo, abs_econ_demo)

compare_econ_demo%>%group_by(source, country, Q16)%>%mutate(count=n())%>%ungroup()%>%group_by(source, country)%>%mutate(percentage=count/n()*100)%>%group_by(source, country, Q16, percentage)%>%summarize()%>%ggplot(aes(source, percentage, fill=as.factor(Q16), label=(paste0(round(percentage,1),"%"))))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank())+facet_grid(~country)

pilot_demo<-pilot%>%select(country, Q17)%>%filter(!is.na(Q17))%>%filter(Q17!="-99")%>%mutate(source="pilot (2021)")

abs_demo<-abs%>%select(country, q125)%>%filter(!is.na(q125))%>%filter(q125>0 & q125<5)%>%mutate(source="abs (2014)")

abs_demo<-abs_demo%>%mutate(Q17=(case_when(q125==1 ~ "Democracy is always preferable to any other kind of government",
                                           q125==2 ~ "Under some circumstances, an authoritarian government can be preferable to a democratic one", 
                                           q125==3 ~ "For people like me, it does not matter whether we have a democratic or nondemocratic regime", 
                                           )))%>%select(-q125)

compare_demo<-rbind(pilot_demo, abs_demo)

compare_demo%>%group_by(source, country, Q17)%>%mutate(count=n())%>%ungroup()%>%group_by(source, country)%>%mutate(percentage=count/n()*100)%>%group_by(source, country, Q17, percentage)%>%summarize()%>%ggplot(aes(source, percentage, fill=as.factor(Q17), label=(paste0(round(percentage,1),"%"))))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank())+facet_grid(~country)

```

# Response quality of the survey - gender, age and education 

## How long are people taking to do the survey? 

- Boxplot removes outliers
- Myanmar is the longest although this is also because there are more questions. This is followed by the Philippines and Indonesia. Function of education levels? 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
pilot$`Duration (in seconds)`<-as.numeric(pilot$`Duration (in seconds)`)
pilot<-pilot%>%mutate(duration=`Duration (in seconds)`/60)

pilot%>%filter(Finished==TRUE)%>%group_by(country)%>%ggplot(aes(x=country, y=duration)) + 
  geom_boxplot(outlier.shape = NA)+scale_y_continuous(limits = c(0, 20))+stat_summary(fun.y=mean, geom="point")+ggtitle("Completed responses") 

pilot%>%filter(Finished==TRUE)%>%group_by(country)%>%summarise(mean=mean(`Duration (in seconds)`/60),
                                                                         median=median(`Duration (in seconds)`/60))

pilot%>%filter(Finished==FALSE)%>%group_by(country)%>%ggplot(aes(x=country, y=duration)) + 
  geom_boxplot(outlier.shape = NA)+scale_y_continuous(limits = c(0, 20))+stat_summary(fun.y=mean, geom="point")+ggtitle("Incomplete responses") 


pilot%>%filter(Finished==FALSE)%>%group_by(country)%>%summarise(mean=mean(`Duration (in seconds)`/60),
                                                                         median=median(`Duration (in seconds)`/60))


```


# Results

## Knowledge about Canada

```{r, echo=FALSE}
idk<-c("Q19", "Q18")
pilot[idk]<-lapply(pilot[idk], factor)
relev <- function(f) fct_relevel(factor(f), ref = "I don’t know")
pilot[idk]<-lapply(pilot[idk], relev)

```

- Myanmar and the Philippines seem to know the least. 

```{r, echo=FALSE, message=FALSE}
for (i in c(47:48)) {
  
  x<-paste(colnames(pilot[,i]))
  yy<-filter(pilot, pilot[[i]]!=-99)
  
  print(yy%>%group_by(country, yy[[i]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[i]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[i]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}
```

Where do people get their info about Canada from? 
- Philippines has substantial from their social networks (which corresponds to a later question about P2P connectivity)
- Most is from social media and websites
- Again, substantial number of people in Myanmar do not seem to get info about Canada at all 

```{r, echo=FALSE, message=FALSE, fig.width=18, fig.height=15}
info<-pilot[,c(49:56, 241)]
info<-info%>%replace_with_na_all(condition=~.x=="-99")
info<-info%>%mutate_at(vars(-country), function(x) ifelse(!is.na(x), 1, 0))
setnames(info, old=c("Q20_1","Q20_2","Q20_3", "Q20_4","Q20_5","Q20_6","Q20_7","Q20_8"), new=c("No info", "Trad. media", "Websites", "Social media", "Social network", "1st-hand info", "Pop culture", "Other"))

info<-info%>%gather(mode, value, `No info`:"Other")

info<-info%>%group_by(country, mode)%>%summarise(count=sum(value))

info$mode<-fct_relevel(info$mode, "No info")

info%>%group_by(country)%>%ggplot(aes(mode, count, label=count))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank())+facet_wrap(~country, scales='free')

pilot%>%filter(!is.na(Q20_1))%>%group_by(country, Q20_1)%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, Q20_1, percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(Q20_1),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+ggtitle("Where do you get info about Canada")+theme(legend.title = element_blank())

```

## Connectivity 

```{r, echo=FALSE, message=FALSE}
for (i in c(1:3)) {
  
  cn<-c("Do you personally know any Canadians?", "Have you been to Canada?", "Have you ever interacted with, or had dealings with, a Canadian org, biz or instn?")
  v<-c(107:108, 117)
  x<-cn[i]
  yy<-filter(pilot, pilot[[v[i]]]!=-99)
  
  print(yy%>%group_by(country, yy[[v[i]]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[v[i]]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[v[i]]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}

```

## Reasons for going to Canada + Ease of obtaining travel documents

```{r, echo=FALSE, message=FALSE, fig.width=15}
travel<-pilot[,c(109:114, 241)]
travel<-travel%>%mutate_at(vars(-country), function(x) ifelse(x=="-99", 0, 1))

setnames(travel, old=colnames(travel[1:6]), new=c("Tourism", "Visit ppl", "Work/Biz", "Studies", "Accompany family", "Others"))

travel<-travel%>%gather(purpose, value, "Tourism":"Others")

travel<-travel%>%filter(!is.na(value))%>%group_by(country, purpose)%>%summarise(count=sum(value))

travel%>%group_by(country)%>%ggplot(aes(purpose, count, label=count))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank())+facet_wrap(~country, scales='free')

pilot$Q28<-factor(pilot$Q28, c("It was very difficult", "It was somewhat difficult", "It was somewhat smooth", "It was very smooth"))

pilot%>%group_by(country, Q28)%>%filter(Q28!="-99")%>%filter(!is.na(Q28))%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, Q28,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(Q28),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank())

```

## P2P connectivity 
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12}
connect<-pilot[,c(118:120, 241)]
connect<-connect%>%mutate_at(vars(-country), function(x) ifelse(x=="-99", 0, 1))

setnames(connect, old=colnames(connect[1:3]), new=c("Migrated", "Worked", "Studied"))


#filter out NA and count per country 
connect<-connect%>%filter(!is.na(Migrated))%>%group_by(country)%>%mutate(total=n())%>%ungroup()

connect<-connect%>%gather(purpose, value, "Migrated":"Studied")

connect%>%group_by(country, purpose)%>%mutate(count=sum(value))%>%ungroup()%>%mutate(percentage=count/total*100)%>%group_by(country, purpose, percentage)%>%summarize()%>%ggplot(aes(purpose, percentage, label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank())+facet_wrap(~country, scales='free')+coord_cartesian(ylim = c(0, 70))

```

```{r, echo=FALSE}
perceptions<-c("Q40", "Q42", "Q44", "Q45", "Q46", "Q47", "Q48", "Q49", "Q50", "Q51")
relev1 <- function(f) fct_relevel(factor(f), c("Strongly disagree", "Somewhat disagree", "Somewhat agree", "Strongly agree", "Not sure"))
pilot[perceptions]<-lapply(pilot[perceptions], relev1)

```

## Perceptions of r/ns btw country and Canada

```{r, echo=FALSE, message=FALSE}
for (i in c(1:3)) {
  
  cn<-c("How would you describe the r/ship between [country] and Canada?", "In your opinion, is country’s economic relations with Canada important to country?", "Canada can play an effective role in supporting country's human security efforts.")
  v<-c(121,156,201)
  x<-cn[i]
  yy<-filter(pilot, pilot[[v[i]]]!=-99)
  
  print(yy%>%group_by(country, yy[[v[i]]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[v[i]]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[v[i]]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}


```

## Political influence

```{r, echo=FALSE, message=FALSE}

for (i in c(1:2)) {
  
  cn<-c("Which of the following countries has the most political influence on your country?", "Canada is an important ally for [country] today")
  v<-c(202:203)
  x<-cn[i]
  yy<-filter(pilot, pilot[[v[i]]]!=-99)
  
  print(yy%>%group_by(country, yy[[v[i]]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[v[i]]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[v[i]]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}

```

## Governance model

```{r, echo=FALSE, message=FALSE}

for (i in c(1:2)) {
  
  cn<-c("Which country best serves as a governance model for the future devt of [country]?", "Canada is a good governance model for the future development of [country].")
  v<-c(204:205)
  x<-cn[i]
  yy<-filter(pilot, pilot[[v[i]]]!=-99)
  
  print(yy%>%group_by(country, yy[[v[i]]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[v[i]]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[v[i]]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}

```


## Perceptions of Canada 

```{r, echo=FALSE, message=FALSE}

for (i in c(1:6)) {
  
  cn<-c("Canada is a country that upholds democratic values.", "Canada is a multicultural society where diversity is celebrated.", "Canada is able to influence the outcome of events on the world stage.", "Canada is a country known for using diplomacy rather than military power to resolve conflicts.", "Canada prioritizes protection of the environment.", "Canada is a world leader in technology and innovation.")
  v<-c(206:211)
  x<-cn[i]
  yy<-filter(pilot, pilot[[v[i]]]!=-99)
  
  print(yy%>%group_by(country, yy[[v[i]]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[v[i]]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[v[i]]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}


```


## Canadian education

```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=15}

pilot$Q51<-factor(pilot$Q51, c("Strongly disagree", "Somewhat disagree", "Somewhat agree", "Strongly agree", "Not sure"))

for (i in c(1:2)) {
  
  cn<-c("A degree from a Canadian institution of higher education is highly regarded in my country.", "If offered a scholarship to a uni, I would like (them) to undertake their post-sec educ in Canada.")
  v<-c(212:213)
  x<-cn[i]
  yy<-filter(pilot, pilot[[v[i]]]!=-99)
  
  print(yy%>%group_by(country, yy[[v[i]]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[v[i]]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[v[i]]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}

```

## Economic perceptions 

```{r, echo=FALSE, message=FALSE}

# create a column for control and treatment 
# pilot<-pilot%>%mutate(expt=ifelse(!is.na(Q36) & Q36!="-99", "treatment", ifelse(!is.na(Q62) & Q62!="-99", "control", NA)))
pilot$opportunities<-coalesce(pilot$Q36, pilot$Q62)
pilot$benefit<-coalesce(pilot$Q37, pilot$Q63)
pilot$supportfta<-coalesce(pilot$Q38, pilot$Q64)

pilot$benefit<-factor(pilot$benefit, c("Strongly disagree", "Somewhat disagree", "Both countries stand to benefit equally", "Somewhat agree", "Strongly agree", "Not sure"))
pilot$opportunities<-factor(pilot$opportunities, c("Strongly disagree", "Somewhat disagree", "Somewhat agree", "Strongly agree", "Not sure"))
pilot$supportfta<-factor(pilot$supportfta, c("Strongly support", "Somewhat support", "Somewhat oppose", "Strongly oppose", "Not sure", "Irrelevant to me"))

for (i in c(1:3)) {
  
  cn<-c("The CND market offers many opportunities for [country's] biz to expand into", "A [country]-Canada FTA will benefit CND businesses more than [country's] businesses", "Would you support a free trade agreement between [country] and Canada?")
  v<-c(257:259)
  x<-cn[i]
  yy<-filter(pilot, pilot[[v[i]]]!=-99)
  
  print(yy%>%group_by(country, yy[[v[i]]])%>%mutate(count=n())%>%ungroup()%>%group_by(country)%>%mutate(percentage=count/n()*100)%>%group_by(country, `yy[[v[i]]]`,percentage)%>%summarize()%>%ggplot(aes(country, percentage, fill=as.factor(`yy[[v[i]]]`),label=(paste0(round(percentage,1), "%"))))+geom_bar(stat="identity")+labs(title=x)+geom_text(size=2.5, position=position_stack(vjust=0.5))+theme(legend.title = element_blank(), axis.title.x = element_blank()))
}


```

